{
    "id": "315",
    "question": {
        "questionId": "315",
        "questionFrontendId": "315",
        "boundTopicId": null,
        "title": "Count of Smaller Numbers After Self",
        "titleSlug": "count-of-smaller-numbers-after-self",
        "content": "<p>You are given an integer array <code>nums</code> and you have to return a new <code>counts</code> array. The <code>counts</code> array has the property where <code>counts[i]</code> is the number of smaller elements to the right of <code>nums[i]</code>.</p>\n\n<p>&nbsp;</p>\n<p><strong>Example 1:</strong></p>\n\n<pre>\n<strong>Input:</strong> nums = [5,2,6,1]\n<strong>Output:</strong> [2,1,1,0]\n<strong>Explanation:</strong>\nTo the right of 5 there are <b>2</b> smaller elements (2 and 1).\nTo the right of 2 there is only <b>1</b> smaller element (1).\nTo the right of 6 there is <b>1</b> smaller element (1).\nTo the right of 1 there is <b>0</b> smaller element.\n</pre>\n\n<p><strong>Example 2:</strong></p>\n\n<pre>\n<strong>Input:</strong> nums = [-1]\n<strong>Output:</strong> [0]\n</pre>\n\n<p><strong>Example 3:</strong></p>\n\n<pre>\n<strong>Input:</strong> nums = [-1,-1]\n<strong>Output:</strong> [0,0]\n</pre>\n\n<p>&nbsp;</p>\n<p><strong>Constraints:</strong></p>\n\n<ul>\n\t<li><code>1 &lt;= nums.length &lt;= 10<sup>5</sup></code></li>\n\t<li><code>-10<sup>4</sup> &lt;= nums[i] &lt;= 10<sup>4</sup></code></li>\n</ul>\n",
        "translatedTitle": null,
        "translatedContent": null,
        "isPaidOnly": false,
        "difficulty": "Hard",
        "likes": 5856,
        "dislikes": 163,
        "isLiked": null,
        "similarQuestions": "[{\"title\": \"Count of Range Sum\", \"titleSlug\": \"count-of-range-sum\", \"difficulty\": \"Hard\", \"translatedTitle\": null}, {\"title\": \"Queue Reconstruction by Height\", \"titleSlug\": \"queue-reconstruction-by-height\", \"difficulty\": \"Medium\", \"translatedTitle\": null}, {\"title\": \"Reverse Pairs\", \"titleSlug\": \"reverse-pairs\", \"difficulty\": \"Hard\", \"translatedTitle\": null}, {\"title\": \"How Many Numbers Are Smaller Than the Current Number\", \"titleSlug\": \"how-many-numbers-are-smaller-than-the-current-number\", \"difficulty\": \"Easy\", \"translatedTitle\": null}, {\"title\": \"Count Good Triplets in an Array\", \"titleSlug\": \"count-good-triplets-in-an-array\", \"difficulty\": \"Hard\", \"translatedTitle\": null}]",
        "exampleTestcases": "[5,2,6,1]\n[-1]\n[-1,-1]",
        "categoryTitle": "Algorithms",
        "contributors": [],
        "topicTags": [
            {
                "name": "Array",
                "slug": "array",
                "translatedName": null,
                "__typename": "TopicTagNode"
            },
            {
                "name": "Binary Search",
                "slug": "binary-search",
                "translatedName": null,
                "__typename": "TopicTagNode"
            },
            {
                "name": "Divide and Conquer",
                "slug": "divide-and-conquer",
                "translatedName": null,
                "__typename": "TopicTagNode"
            },
            {
                "name": "Binary Indexed Tree",
                "slug": "binary-indexed-tree",
                "translatedName": null,
                "__typename": "TopicTagNode"
            },
            {
                "name": "Segment Tree",
                "slug": "segment-tree",
                "translatedName": null,
                "__typename": "TopicTagNode"
            },
            {
                "name": "Merge Sort",
                "slug": "merge-sort",
                "translatedName": null,
                "__typename": "TopicTagNode"
            },
            {
                "name": "Ordered Set",
                "slug": "ordered-set",
                "translatedName": null,
                "__typename": "TopicTagNode"
            }
        ],
        "companyTagStats": "{\"1\": [{\"taggedByAdmin\": true, \"name\": \"Google\", \"slug\": \"google\", \"timesEncountered\": 6}, {\"taggedByAdmin\": false, \"name\": \"Amazon\", \"slug\": \"amazon\", \"timesEncountered\": 3}, {\"taggedByAdmin\": false, \"name\": \"Microsoft\", \"slug\": \"microsoft\", \"timesEncountered\": 3}, {\"taggedByAdmin\": false, \"name\": \"Adobe\", \"slug\": \"adobe\", \"timesEncountered\": 2}], \"2\": [{\"taggedByAdmin\": false, \"name\": \"Apple\", \"slug\": \"apple\", \"timesEncountered\": 4}, {\"taggedByAdmin\": false, \"name\": \"Uber\", \"slug\": \"uber\", \"timesEncountered\": 2}, {\"taggedByAdmin\": false, \"name\": \"Sprinklr\", \"slug\": \"sprinklr\", \"timesEncountered\": 2}], \"3\": [{\"taggedByAdmin\": false, \"name\": \"Bloomberg\", \"slug\": \"bloomberg\", \"timesEncountered\": 5}, {\"taggedByAdmin\": false, \"name\": \"Myntra\", \"slug\": \"myntra\", \"timesEncountered\": 3}]}",
        "codeSnippets": [
            {
                "lang": "C++",
                "langSlug": "cpp",
                "code": "class Solution {\npublic:\n    vector<int> countSmaller(vector<int>& nums) {\n        \n    }\n};",
                "__typename": "CodeSnippetNode"
            },
            {
                "lang": "Java",
                "langSlug": "java",
                "code": "class Solution {\n    public List<Integer> countSmaller(int[] nums) {\n        \n    }\n}",
                "__typename": "CodeSnippetNode"
            },
            {
                "lang": "Python",
                "langSlug": "python",
                "code": "class Solution(object):\n    def countSmaller(self, nums):\n        \"\"\"\n        :type nums: List[int]\n        :rtype: List[int]\n        \"\"\"\n        ",
                "__typename": "CodeSnippetNode"
            },
            {
                "lang": "Python3",
                "langSlug": "python3",
                "code": "class Solution:\n    def countSmaller(self, nums: List[int]) -> List[int]:\n        ",
                "__typename": "CodeSnippetNode"
            },
            {
                "lang": "C",
                "langSlug": "c",
                "code": "\n\n/**\n * Note: The returned array must be malloced, assume caller calls free().\n */\nint* countSmaller(int* nums, int numsSize, int* returnSize){\n\n}",
                "__typename": "CodeSnippetNode"
            },
            {
                "lang": "C#",
                "langSlug": "csharp",
                "code": "public class Solution {\n    public IList<int> CountSmaller(int[] nums) {\n        \n    }\n}",
                "__typename": "CodeSnippetNode"
            },
            {
                "lang": "JavaScript",
                "langSlug": "javascript",
                "code": "/**\n * @param {number[]} nums\n * @return {number[]}\n */\nvar countSmaller = function(nums) {\n    \n};",
                "__typename": "CodeSnippetNode"
            },
            {
                "lang": "Ruby",
                "langSlug": "ruby",
                "code": "# @param {Integer[]} nums\n# @return {Integer[]}\ndef count_smaller(nums)\n    \nend",
                "__typename": "CodeSnippetNode"
            },
            {
                "lang": "Swift",
                "langSlug": "swift",
                "code": "class Solution {\n    func countSmaller(_ nums: [Int]) -> [Int] {\n        \n    }\n}",
                "__typename": "CodeSnippetNode"
            },
            {
                "lang": "Go",
                "langSlug": "golang",
                "code": "func countSmaller(nums []int) []int {\n    \n}",
                "__typename": "CodeSnippetNode"
            },
            {
                "lang": "Scala",
                "langSlug": "scala",
                "code": "object Solution {\n    def countSmaller(nums: Array[Int]): List[Int] = {\n        \n    }\n}",
                "__typename": "CodeSnippetNode"
            },
            {
                "lang": "Kotlin",
                "langSlug": "kotlin",
                "code": "class Solution {\n    fun countSmaller(nums: IntArray): List<Int> {\n        \n    }\n}",
                "__typename": "CodeSnippetNode"
            },
            {
                "lang": "Rust",
                "langSlug": "rust",
                "code": "impl Solution {\n    pub fn count_smaller(nums: Vec<i32>) -> Vec<i32> {\n        \n    }\n}",
                "__typename": "CodeSnippetNode"
            },
            {
                "lang": "PHP",
                "langSlug": "php",
                "code": "class Solution {\n\n    /**\n     * @param Integer[] $nums\n     * @return Integer[]\n     */\n    function countSmaller($nums) {\n        \n    }\n}",
                "__typename": "CodeSnippetNode"
            },
            {
                "lang": "TypeScript",
                "langSlug": "typescript",
                "code": "function countSmaller(nums: number[]): number[] {\n\n};",
                "__typename": "CodeSnippetNode"
            },
            {
                "lang": "Racket",
                "langSlug": "racket",
                "code": "(define/contract (count-smaller nums)\n  (-> (listof exact-integer?) (listof exact-integer?))\n\n  )",
                "__typename": "CodeSnippetNode"
            },
            {
                "lang": "Erlang",
                "langSlug": "erlang",
                "code": "-spec count_smaller(Nums :: [integer()]) -> [integer()].\ncount_smaller(Nums) ->\n  .",
                "__typename": "CodeSnippetNode"
            },
            {
                "lang": "Elixir",
                "langSlug": "elixir",
                "code": "defmodule Solution do\n  @spec count_smaller(nums :: [integer]) :: [integer]\n  def count_smaller(nums) do\n\n  end\nend",
                "__typename": "CodeSnippetNode"
            }
        ],
        "stats": "{\"totalAccepted\": \"234.2K\", \"totalSubmission\": \"557.3K\", \"totalAcceptedRaw\": 234173, \"totalSubmissionRaw\": 557346, \"acRate\": \"42.0%\"}",
        "hints": [],
        "solution": {
            "id": "1138",
            "canSeeDetail": true,
            "paidOnly": true,
            "hasVideoSolution": false,
            "paidOnlyVideo": true,
            "__typename": "ArticleNode"
        },
        "status": "notac",
        "sampleTestCase": "[5,2,6,1]",
        "metaData": "{\n  \"name\": \"countSmaller\",\n  \"params\": [\n    {\n      \"name\": \"nums\",\n      \"type\": \"integer[]\"\n    }\n  ],\n  \"return\": {\n    \"type\": \"list<integer>\",\n    \"dealloc\": true\n  }\n}",
        "judgerAvailable": true,
        "judgeType": "large",
        "mysqlSchemas": [],
        "enableRunCode": true,
        "enableTestMode": false,
        "enableDebugger": true,
        "envInfo": "{\"cpp\": [\"C++\", \"<p>Compiled with <code> clang 11 </code> using the latest C++ 17 standard.</p>\\r\\n\\r\\n<p>Your code is compiled with level two optimization (<code>-O2</code>). <a href=\\\"https://github.com/google/sanitizers/wiki/AddressSanitizer\\\" target=\\\"_blank\\\">AddressSanitizer</a> is also enabled to help detect out-of-bounds and use-after-free bugs.</p>\\r\\n\\r\\n<p>Most standard library headers are already included automatically for your convenience.</p>\"], \"java\": [\"Java\", \"<p><code> OpenJDK 17 </code>. Java 8 features such as lambda expressions and stream API can be used. </p>\\r\\n\\r\\n<p>Most standard library headers are already included automatically for your convenience.</p>\\r\\n<p>Includes <code>Pair</code> class from https://docs.oracle.com/javase/8/javafx/api/javafx/util/Pair.html.</p>\"], \"python\": [\"Python\", \"<p><code>Python 2.7.12</code>.</p>\\r\\n\\r\\n<p>Most libraries are already imported automatically for your convenience, such as <a href=\\\"https://docs.python.org/2/library/array.html\\\" target=\\\"_blank\\\">array</a>, <a href=\\\"https://docs.python.org/2/library/bisect.html\\\" target=\\\"_blank\\\">bisect</a>, <a href=\\\"https://docs.python.org/2/library/collections.html\\\" target=\\\"_blank\\\">collections</a>. If you need more libraries, you can import it yourself.</p>\\r\\n\\r\\n<p>For Map/TreeMap data structure, you may use <a href=\\\"http://www.grantjenks.com/docs/sortedcontainers/\\\" target=\\\"_blank\\\">sortedcontainers</a> library.</p>\\r\\n\\r\\n<p>Note that Python 2.7 <a href=\\\"https://www.python.org/dev/peps/pep-0373/\\\" target=\\\"_blank\\\">will not be maintained past 2020</a>. For the latest Python, please choose Python3 instead.</p>\"], \"c\": [\"C\", \"<p>Compiled with <code>gcc 8.2</code> using the gnu11 standard.</p>\\r\\n\\r\\n<p>Your code is compiled with level one optimization (<code>-O1</code>). <a href=\\\"https://github.com/google/sanitizers/wiki/AddressSanitizer\\\" target=\\\"_blank\\\">AddressSanitizer</a> is also enabled to help detect out-of-bounds and use-after-free bugs.</p>\\r\\n\\r\\n<p>Most standard library headers are already included automatically for your convenience.</p>\\r\\n\\r\\n<p>For hash table operations, you may use <a href=\\\"https://troydhanson.github.io/uthash/\\\" target=\\\"_blank\\\">uthash</a>. \\\"uthash.h\\\" is included by default. Below are some examples:</p>\\r\\n\\r\\n<p><b>1. Adding an item to a hash.</b>\\r\\n<pre>\\r\\nstruct hash_entry {\\r\\n    int id;            /* we'll use this field as the key */\\r\\n    char name[10];\\r\\n    UT_hash_handle hh; /* makes this structure hashable */\\r\\n};\\r\\n\\r\\nstruct hash_entry *users = NULL;\\r\\n\\r\\nvoid add_user(struct hash_entry *s) {\\r\\n    HASH_ADD_INT(users, id, s);\\r\\n}\\r\\n</pre>\\r\\n</p>\\r\\n\\r\\n<p><b>2. Looking up an item in a hash:</b>\\r\\n<pre>\\r\\nstruct hash_entry *find_user(int user_id) {\\r\\n    struct hash_entry *s;\\r\\n    HASH_FIND_INT(users, &user_id, s);\\r\\n    return s;\\r\\n}\\r\\n</pre>\\r\\n</p>\\r\\n\\r\\n<p><b>3. Deleting an item in a hash:</b>\\r\\n<pre>\\r\\nvoid delete_user(struct hash_entry *user) {\\r\\n    HASH_DEL(users, user);  \\r\\n}\\r\\n</pre>\\r\\n</p>\"], \"csharp\": [\"C#\", \"<p><a href=\\\"https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-9\\\" target=\\\"_blank\\\">C# 10 with .NET 6 runtime</a></p>\"], \"javascript\": [\"JavaScript\", \"<p><code>Node.js 16.13.2</code>.</p>\\r\\n\\r\\n<p>Your code is run with <code>--harmony</code> flag, enabling <a href=\\\"http://node.green/\\\" target=\\\"_blank\\\">new ES6 features</a>.</p>\\r\\n\\r\\n<p><a href=\\\"https://lodash.com\\\" target=\\\"_blank\\\">lodash.js</a> library is included by default.</p>\\r\\n\\r\\n<p>For Priority Queue / Queue data structures, you may use <a href=\\\"https://github.com/datastructures-js/priority-queue\\\" target=\\\"_blank\\\">datastructures-js/priority-queue</a> and <a href=\\\"https://github.com/datastructures-js/queue\\\" target=\\\"_blank\\\">datastructures-js/queue</a>.</p>\"], \"ruby\": [\"Ruby\", \"<p><code>Ruby 3.1</code></p>\\r\\n\\r\\n<p>Some common data structure implementations are provided in the Algorithms module: https://www.rubydoc.info/github/kanwei/algorithms/Algorithms</p>\"], \"swift\": [\"Swift\", \"<p><code>Swift 5.5.2</code>.</p>\"], \"golang\": [\"Go\", \"<p><code>Go 1.17.6</code>.</p>\\r\\n\\r\\n<p>Support <a href=\\\"https://godoc.org/github.com/emirpasic/gods\\\" target=\\\"_blank\\\">https://godoc.org/github.com/emirpasic/gods</a> library.</p>\"], \"python3\": [\"Python3\", \"<p><code>Python 3.10</code>.</p>\\r\\n\\r\\n<p>Most libraries are already imported automatically for your convenience, such as <a href=\\\"https://docs.python.org/3/library/array.html\\\" target=\\\"_blank\\\">array</a>, <a href=\\\"https://docs.python.org/3/library/bisect.html\\\" target=\\\"_blank\\\">bisect</a>, <a href=\\\"https://docs.python.org/3/library/collections.html\\\" target=\\\"_blank\\\">collections</a>. If you need more libraries, you can import it yourself.</p>\\r\\n\\r\\n<p>For Map/TreeMap data structure, you may use <a href=\\\"http://www.grantjenks.com/docs/sortedcontainers/\\\" target=\\\"_blank\\\">sortedcontainers</a> library.</p>\"], \"scala\": [\"Scala\", \"<p><code>Scala 2.13.7</code>.</p>\"], \"kotlin\": [\"Kotlin\", \"<p><code>Kotlin 1.3.10</code>.</p>\"], \"rust\": [\"Rust\", \"<p><code>Rust 1.58.1</code></p>\\r\\n\\r\\n<p>Supports <a href=\\\"https://crates.io/crates/rand\\\" target=\\\"_blank\\\">rand </a> v0.6\\u00a0from crates.io</p>\"], \"php\": [\"PHP\", \"<p><code>PHP 8.1</code>.</p>\\r\\n<p>With bcmath module</p>\"], \"typescript\": [\"Typescript\", \"<p><code>TypeScript 4.5.4, Node.js 16.13.2</code>.</p>\\r\\n\\r\\n<p>Your code is run with <code>--harmony</code> flag, enabling <a href=\\\"http://node.green/\\\" target=\\\"_blank\\\">new ES2020 features</a>.</p>\\r\\n\\r\\n<p><a href=\\\"https://lodash.com\\\" target=\\\"_blank\\\">lodash.js</a> library is included by default.</p>\"], \"racket\": [\"Racket\", \"<p>Run with <code>Racket 8.3</code>.</p>\"], \"erlang\": [\"Erlang\", \"Erlang/OTP 24.2\"], \"elixir\": [\"Elixir\", \"Elixir 1.13.0 with Erlang/OTP 24.2\"]}",
        "libraryUrl": null,
        "adminUrl": null,
        "challengeQuestion": {
            "id": "993",
            "date": "2022-07-23",
            "incompleteChallengeCount": 14,
            "streakCount": 0,
            "type": "DAILY",
            "__typename": "ChallengeQuestionNode"
        },
        "__typename": "QuestionNode"
    },
    "solution": {
        "id": "1138",
        "content": "[TOC]\r\n\r\n## Solution\r\n\r\n---\r\n\r\n#### Overview\r\n\r\nThe problem is straightforward. For each `num` in `nums`, we need to obtain the number of smaller elements after `num`.\r\n\r\nA straightforward approach is to use brute force with two for-loops. The first loop iterates over all `num` in `nums`, and the second loop iterates over all elements after `num`. However, this approach costs $$O(N^2)$$ and yields _Time Limit Exceed_, given that $$N$$ is the length of `nums`.\r\n\r\nLuckily, there are two helpful data structures: [segment tree](https://en.wikipedia.org/wiki/Segment_tree) and [binary indexed tree](https://en.wikipedia.org/wiki/Fenwick_tree), which are able to do the range query in logarithmic time.\r\n\r\nAlso, a solution based on [Merge Sort](https://en.wikipedia.org/wiki/Merge_sort) is available.\r\n\r\nBelow, we will discuss each of the three approaches: _Segment Tree_, _Binary Indexed Tree_, and _Merge Sort_.\r\n\r\n> After you finish, you can practice by solving some similar questions:\r\n>\r\n> - [Reverse Pairs](https://leetcode.com/problems/reverse-pairs/solution/)\r\n> - [Create Sorted Array through Instructions](https://leetcode.com/problems/create-sorted-array-through-instructions/)\r\n\r\n</br>\r\n\r\n---\r\n\r\n#### Approach 1: Segment Tree\r\n\r\n**Intuition**\r\n\r\n> **Prerequisite: segment tree**\r\n>\r\n> If you are not familiar with segment trees, you should check out our [Recursive Approach to segment trees](https://leetcode.com/articles/a-recursive-approach-to-segment-trees-range-sum-queries-lazy-propagation/) tutorial before continuing.\r\n>\r\n> Also, here are some relevant applications for segment trees that you can practice on:\r\n>\r\n> - [Range Sum Query - Mutable](https://leetcode.com/problems/range-sum-query-mutable/)\r\n> - [Count of Range Sum](https://leetcode.com/problems/count-of-range-sum/)\r\n>\r\n> For a full list, check out the [segment tree Tag](https://leetcode.com/tag/segment-tree/).\r\n\r\nFor a particular element in `nums`, located at index `i`, we want to count how many of the numbers on the right side of index `i` are smaller than `nums[i]`. Notice that the value of the smaller numbers must be in the range $$(-\\infty, \\text{nums[i]}-1]$$.\r\n\r\nHence, if we can find the count of **each number** in the range $$(-\\infty, \\text{nums[i]}-1]$$ on the right side of index `i`, then the answer will be the sum of those counts.\r\n\r\nTherefore, for each index `i`, we need a query to find the sum of those counts. Recall that the segment tree and the binary indexed tree are two data structures that are generally helpful when solving range query problems.\r\n\r\nSince we need counts of values, we can use an approach similar to [bucket sort](https://en.wikipedia.org/wiki/Bucket_sort), where we have buckets of values and `buckets[value]` stores the count of `value`. For each value, we increment `buckets[value]` by 1. With this approach, the number of elements smaller than `nums[i]` is the range sum of $$(-\\infty, \\text{num}-1]$$ in buckets.\r\n\r\nWith the help of a segment tree or binary indexed tree, we can perform the range sum query in logarithmic time.\r\n\r\n![Figure 1](../Documents/315/315_bucket1.drawio.svg)\r\n\r\n![Figure 2](../Documents/315/315_bucket2.drawio.svg)\r\n\r\nWith the given constraint `-10^4 <= nums[i] <= 10^4`, we can initialize buckets from `-10^4` to `10^4`.\r\n\r\nWait, there is a problem: Usually, we store buckets in an array, so the indices of buckets are non-negative. However, here we need to store some **negative** values. How can we resolve this problem?\r\n\r\nThere are two solutions:\r\n\r\n1. Use a map rather than an array.\r\n2. Shift all numbers to non-negative.\r\n\r\nBoth solutions work, and here we have chosen the second one since it is easier to implement. Interested readers are welcome to try the first one on their own.\r\n\r\nTo shift all numbers to non-negative, we simply add a constant. Here we chose the constant `offset = 10^4` and increase each number by `offset`:\r\n\r\n```python\r\nnums[i] = nums[i] + offset\r\n```\r\n\r\nThe smallest number `-10^4` becomes `0` under this shift.\r\n\r\n![Figure 3](../Documents/315/315_shift.drawio.svg)\r\n\r\nNote that while querying a particular index, we only need to consider elements that are on the right side of the index. Therefore we need to make sure that when we query an index, say `i`, only elements from index `i+1` to the end of the array are present in the buckets.\r\n\r\nTo achieve this, we need to traverse `nums` from **right to left**, while performing range sum queries and updating the counts.\r\n\r\nSimilarly, with the help of a segment tree or binary indexed tree, we can perform the updates in logarithmic time.\r\n\r\n![Figure 4](../Documents/315/315_right_to_left.drawio.svg)\r\n\r\n(For convenience, the offset is not included in the above picture.)\r\n\r\n**Algorithm**\r\n\r\n- Implement the segment tree. Since the tree is initialized with all zeros, only `update` and `query` need to be implemented. Set `offset = 10^4`.\r\n\r\n- Iterate over each `num` in `nums` in reverse. For each `num`:\r\n\r\n  - Shift `num` to `num + offset`.\r\n  - Query the number of elements in the segment tree smaller than `num`.\r\n  - Update the count of `num` in the segment tree.\r\n\r\n- Return the result.\r\n\r\n**Implementation**\r\n\r\n<iframe src=\"https://leetcode.com/playground/JkZ5ysmJ/shared\" frameBorder=\"0\" width=\"100%\" height=\"500\" name=\"JkZ5ysmJ\"></iframe>\r\n\r\n**Complexity Analysis**\r\n\r\nLet $$N$$ be the length of `nums` and $$M$$ be the difference between the maximum and minimum values in `nums`.\r\n\r\nNote that for convenience, we fix $$M=2*10^4$$ in the above implementations.\r\n\r\n- Time Complexity: $$O(N\\log(M))$$.  \r\n  We need to iterate over `nums`. For each element, we spend $$O(\\log(M))$$ to find the number of smaller elements after it, and spend $$O(\\log(M))$$ time to update the counts. In total, we need $$O(N \\cdot \\log(M)) = O(N\\log(M))$$ time.\r\n\r\n- Space Complexity: $$O(M)$$, since we need, at most, an array of size $$2M+2$$ to store the segment tree.  \r\n  We need at most $$M+1$$ buckets, where the extra $$1$$ is for the value $$0$$. For the segment tree, we need twice the number of buckets, which is $$(M+1)\\times 2 = 2M+2$$.\r\n\r\n\r\n</br>\r\n\r\n---\r\n\r\n#### Approach 2: Binary Indexed Tree (Fenwick Tree)\r\n\r\n**Intuition**\r\n\r\n> **Prerequisite: binary indexed tree**\r\n>\r\n> If you are not familiar with binary indexed tree (BIT), you should check relevant tutorials, such as [Range Sum Query 2D - Mutable](https://leetcode.com/problems/range-sum-query-2d-mutable/solution/) before continuing.\r\n>\r\n> Also, here are some relevant applications for binary indexed trees that you can practice on:\r\n>\r\n> - [Range Sum Query - Mutable](https://leetcode.com/problems/range-sum-query-mutable/)\r\n> - [Count of Range Sum](https://leetcode.com/problems/count-of-range-sum/)\r\n>\r\n> (Yes, many problems which can be solved by segment tree can also be solved by binary indexed tree.)\r\n>\r\n> For a full list, you can check the [binary indexed tree Tag](https://leetcode.com/tag/binary-indexed-tree/).\r\n\r\nBinary indexed tree is similar to segment tree. It allows us to perform a prefix query, such as prefix sum, in $$\\log$$ time. Can we transform this problem into a **prefix sum** problem?\r\n\r\nYes, using the same tricks that we used in approach 1, buckets and shift, we can transform the number of smaller elements into a prefix sum for the range $$[0, \\text{num}+\\text{offset}-1]$$, where $$\\text{offset}=10^4$$.\r\n\r\n![Figure 5](../Documents/315/315_bit.drawio.svg)\r\n\r\nSimilarly, when querying, we need to traverse `nums` from right to left in order to ensure that only the elements to the right are in the buckets.\r\n\r\n**Algorithm**\r\n\r\n- Implement the binary indexed tree. Since the tree is initialized with all zeros, only `update` and `query` need to be implemented. Set `offset = 10^4`.\r\n\r\n- Iterate over each `num` in `nums` in reverse. For each `num`:\r\n\r\n  - Shift `num` to `num + offset`.\r\n  - Query the number of elements in the BIT that are smaller than `num`.\r\n  - Update the count of `num` in the BIT.\r\n\r\n- Return the result.\r\n\r\n**Implementation**\r\n\r\n<iframe src=\"https://leetcode.com/playground/NSkvX6EL/shared\" frameBorder=\"0\" width=\"100%\" height=\"500\" name=\"NSkvX6EL\"></iframe>\r\n\r\n**Complexity Analysis**\r\n\r\nLet $$N$$ be the length of `nums` and $$M$$ be the difference between the maximum and minimum values in `nums`.\r\n\r\nNote that for convenience, we fix $$M=2*10^4$$ in the above implementations.\r\n\r\n- Time Complexity: $$O(N\\log(M))$$.  \r\n  We need to iterate over `nums`. For each element, we spend $$O(\\log(M))$$ to find the number of smaller elements after it, and spend $$O(\\log(M))$$ time to update the counts. In total, we need $$O(N \\cdot \\log(M)) = O(N\\log(M))$$ time.\r\n\r\n- Space Complexity: $$O(M)$$, since we need, at most, an array of size $$M+2$$ to store the BIT.  \r\nWe need at most $$M+1$$ buckets, where the extra $$1$$ is for the value $$0$$. The BIT requires an extra dummy node, so the size is $$(M+1)+1 = M+2$$.\r\n\r\n</br>\r\n\r\n---\r\n\r\n#### Approach 3: Merge Sort\r\n\r\n**Intuition**\r\n\r\n> **Prerequisite: Merge Sort**\r\n>\r\n> If you are not familiar with Merge Sort, you should check relevant tutorials before continuing.\r\n>\r\n> Also, here is a basic application of Merge Sort that you can practice on:\r\n>\r\n> - [Sort an Array](https://leetcode.com/problems/sort-an-array/)\r\n\r\nTo apply merge sort, one key observation is that:\r\n\r\n> The smaller elements on the right of a number will **jump from its right to its left** during the sorting process.\r\n\r\n![Figure 6](../Documents/315/315_jumping.drawio.svg)\r\n\r\nIf we can record the numbers of those elements during sorting, then the problem is solved.\r\n\r\nCan we modify the merge sort a little to meet our needs?\r\n\r\nConsider when merging two sorted list\r\n\r\n![Figure 7](../Documents/315/315_merging.drawio.svg)\r\n\r\nYes! When we select an element `i` on the left array, we know that elements selected previously from the right array **jump** from `i`'s right to `i`'s left.\r\n\r\nBy adding the counts of those elements in every merge step, we get the total number of elements that jumped from `i`'s right to `i`'s left.\r\n\r\n**Algorithm**\r\n\r\n- Implement a merge sort function.\r\n\r\n  - For each element `i`, the function records the number of elements jumping from `i`'s right to `i`'s left during the merge sort.\r\n\r\n- Merge sort `nums`, store the number of elements jumping from right to left in `result`.\r\n\r\n  - Alternatively, one can sort the _indices_ with corresponding values in `nums`. That is to say, we are going to sort list `[0, 1, ..., n-1]` according to the comparator `nums[i]`. This helps to track the indices and update `result`. You can find additional details in the implementations below.\r\n\r\n- Return `result`.\r\n\r\n**Implementation**\r\n\r\n<iframe src=\"https://leetcode.com/playground/deoB8KuH/shared\" frameBorder=\"0\" width=\"100%\" height=\"500\" name=\"deoB8KuH\"></iframe>\r\n\r\n**Complexity Analysis**\r\n\r\nLet $$N$$ be the length of `nums`.\r\n\r\n- Time Complexity: $$O(N\\log(N))$$. We need to perform a merge sort which takes $$O(N\\log(N))$$ time. All other operations take at most $$O(N)$$ time.\r\n\r\n- Space Complexity: $$O(N)$$, since we need a constant number of arrays of size $$O(N)$$.\r\n\r\n\r\n<br/>",
        "contentTypeId": "107",
        "canSeeDetail": true,
        "paidOnly": true,
        "hasVideoSolution": false,
        "paidOnlyVideo": true,
        "rating": {
            "id": "1143",
            "count": 58,
            "average": "4.500",
            "userRating": null,
            "__typename": "RatingNode"
        },
        "__typename": "ArticleNode"
    },
    "questionCode": "count-of-smaller-numbers-after-self",
    "playgroundData": {
        "JkZ5ysmJ": {
            "playground": {
                "testcaseInput": "",
                "name": "count-of-smaller-numbers-after-self-2",
                "isUserOwner": false,
                "isLive": false,
                "showRunCode": false,
                "showOpenInPlayground": false,
                "selectedLangSlug": "cpp",
                "isShared": true,
                "__typename": "PlaygroundNode"
            },
            "allPlaygroundCodes": [
                {
                    "code": "class Solution {\n    public int[] twoSum(int[] nums, int target) {\n        for (int i = 0; i < nums.length; i++) {\n            for (int j = i + 1; j < nums.length; j++) {\n                if (nums[j] == target - nums[i]) {\n                    return new int[] { i, j };\n                }\n            }\n        }\n        // In case there is no solution, we'll just return null\n        return null;\n    }\n}",
                    "langSlug": "java",
                    "__typename": "PlaygroundCodeNode"
                },
                {
                    "code": "class Solution:\n    def twoSum(self, nums: List[int], target: int) -> List[int]:\n        for i in range(len(nums)):\n            for j in range(i + 1, len(nums)):\n                if nums[j] == target - nums[i]:\n                    return [i, j]",
                    "langSlug": "python3",
                    "__typename": "PlaygroundCodeNode"
                }
            ]
        },
        "NSkvX6EL": {
            "playground": {
                "testcaseInput": "",
                "name": "count-of-smaller-numbers-after-self-1",
                "isUserOwner": false,
                "isLive": false,
                "showRunCode": false,
                "showOpenInPlayground": false,
                "selectedLangSlug": "cpp",
                "isShared": true,
                "__typename": "PlaygroundNode"
            },
            "allPlaygroundCodes": [
                {
                    "code": "class Solution {\n    public int[] twoSum(int[] nums, int target) {\n        for (int i = 0; i < nums.length; i++) {\n            for (int j = i + 1; j < nums.length; j++) {\n                if (nums[j] == target - nums[i]) {\n                    return new int[] { i, j };\n                }\n            }\n        }\n        // In case there is no solution, we'll just return null\n        return null;\n    }\n}",
                    "langSlug": "java",
                    "__typename": "PlaygroundCodeNode"
                },
                {
                    "code": "class Solution:\n    def twoSum(self, nums: List[int], target: int) -> List[int]:\n        for i in range(len(nums)):\n            for j in range(i + 1, len(nums)):\n                if nums[j] == target - nums[i]:\n                    return [i, j]",
                    "langSlug": "python3",
                    "__typename": "PlaygroundCodeNode"
                }
            ]
        },
        "deoB8KuH": {
            "playground": {
                "testcaseInput": "",
                "name": "count-of-smaller-numbers-after-self-0",
                "isUserOwner": false,
                "isLive": false,
                "showRunCode": false,
                "showOpenInPlayground": false,
                "selectedLangSlug": "cpp",
                "isShared": true,
                "__typename": "PlaygroundNode"
            },
            "allPlaygroundCodes": [
                {
                    "code": "class Solution {\n    public int[] twoSum(int[] nums, int target) {\n        for (int i = 0; i < nums.length; i++) {\n            for (int j = i + 1; j < nums.length; j++) {\n                if (nums[j] == target - nums[i]) {\n                    return new int[] { i, j };\n                }\n            }\n        }\n        // In case there is no solution, we'll just return null\n        return null;\n    }\n}",
                    "langSlug": "java",
                    "__typename": "PlaygroundCodeNode"
                },
                {
                    "code": "class Solution:\n    def twoSum(self, nums: List[int], target: int) -> List[int]:\n        for i in range(len(nums)):\n            for j in range(i + 1, len(nums)):\n                if nums[j] == target - nums[i]:\n                    return [i, j]",
                    "langSlug": "python3",
                    "__typename": "PlaygroundCodeNode"
                }
            ]
        }
    }
}